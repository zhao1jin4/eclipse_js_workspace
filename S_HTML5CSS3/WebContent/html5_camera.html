<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Camera API</title>
        <!-- 
        <link rel="stylesheet" href="css/base.css" type="text/css" media="screen">
         -->
    </head>

    <body>

        <div class="container">
            <h1>Camera API</h1>

            <section class="main-content">
                <p>A demo of the Camera API, currently implemented in Firefox and Google Chrome on Android. Choose to take a picture with your device's camera and a preview will be shown through createObjectURL or a FileReader object (choosing local files supported too).</p>
                
                <p>
                    <input type="file" id="take-picture" accept="image/*">
                </p>

                <h2>Preview:</h2>
                <p>
                    <img src="about:blank" alt="" id="show-picture">
                </p>

                <p id="error"></p>

            </section>

            <p class="footer">All the code is available in the <a href="https://github.com/robnyman/robnyman.github.com/tree/master/camera-api">Camera API repository on GitHub</a>.</p>
        </div>


        <script type="text/javascript">
        (function () {
            var takePicture = document.querySelector("#take-picture"),
                showPicture = document.querySelector("#show-picture");

            if (takePicture && showPicture) {
                // Set events
                takePicture.onchange = function (event) {
                    // Get a reference to the taken picture or chosen file
                    var files = event.target.files,
                        file;
                    if (files && files.length > 0) {
                        file = files[0];
                        try {
                            // Create ObjectURL
                            var imgURL = window.URL.createObjectURL(file);
							// 格式(blob)      blob:http://localhost:8080/5b543137-906b-40d5-8ba9-faf0739822c7
                            // Set img src to ObjectURL
                            showPicture.src = imgURL;  //firefox OK,Chrome不行？？？

                            // Revoke ObjectURL
                            URL.revokeObjectURL(imgURL);
                        }
                        catch (e) {
                            try {
                                // Fallback if createObjectURL is not supported
                                var fileReader = new FileReader();
                                fileReader.onload = function (event) {
                                    showPicture.src = event.target.result;
                                };
                                fileReader.readAsDataURL(file);
                            }
                            catch (e) {
                                //
                                var error = document.querySelector("#error");
                                if (error) {
                                    error.innerHTML = "Neither createObjectURL or FileReader are supported";
                                }
                            }
                        }
                    }
                };
            }
        })();
        </script>

		<br/>
		<hr/>
		<video id="video" autoplay></video>
		
<script type="text/javascript">
	//var getUserMedia =  navigator.getUserMedia ;//Chrome OK,Edge OK,Firefox NO
	//var getUserMedia =  navigator.mozGetUserMedia ;//Firefox OK
    var getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);

    getUserMedia.call(navigator, 
   		{
	        video: true,
	        audio: true
	    }, 
		function(localMediaStream)
		{
	        var video = document.getElementById('video');
	        video.src = window.URL.createObjectURL(localMediaStream);//Chrome OK,Edge OK 但播放声音有很大的噪音,Firefox NO
	        
	        video.onloadedmetadata = function(e) 
	        {
	            console.log("Label: " + localMediaStream.label);//undefined
	            console.log("AudioTracks" , localMediaStream.getAudioTracks());
	            console.log("AudioTracks label" , localMediaStream.getAudioTracks()[0].label);
	            console.log("VideoTracks" , localMediaStream.getVideoTracks());
	            console.log("VideoTracks label" , localMediaStream.getVideoTracks()[0].label);
	        };
	    }, 
	    function(e) {
	        console.log('Reeeejected!', e);
	    });
</script>
		
    </body>
</html>